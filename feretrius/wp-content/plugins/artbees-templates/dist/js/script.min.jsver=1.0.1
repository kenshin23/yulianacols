"use strict";function ownKeys(t,e){var s=Object.keys(t);return Object.getOwnPropertySymbols&&s.push.apply(s,Object.getOwnPropertySymbols(t)),e&&(s=s.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(s,!0).forEach(function(e){_defineProperty(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ownKeys(s).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),e}!function(c){var s=function(){function n(e){_classCallCheck(this,n);var t=e.element,s=e.updateResults;this.element=t,this.filters=this.element.find(".filter-field"),this.contentFilter=this.filters.filter("[name=s]"),this.window=c(window),this.body=c("body"),this.updateResults=s,this.desktop=768,this.init(),this.events()}return _createClass(n,[{key:"init",value:function(){var e=this,t=e.element,s=e.filters,n=t.find(".ats-select-field");s.filter(":not([type=text])").on("change",_.debounce(e.update.bind(e),300)),s.filter("[type=text]").on("keyup",_.debounce(e.update.bind(e),300)),n.each(function(e,t){new i(c(t))})}},{key:"events",value:function(){var e=this,t=c(".jupiterx-header");if(t.length){var s=t.data("jupiterx-settings"),n=s.behavior,i=s.position;"fixed"===n&&"top"===i?(e.fixed(),e.window.resize(e.fixed.bind(e))):"sticky"===n&&(e.sticky(),e.window.scroll(e.sticky.bind(e)))}}},{key:"fixed",value:function(){var e=this,t=e.element,s=e.body,n=e.desktop;if(e.window.width()>=n){var i=c(".jupiterx-header"),a=s.offset(),o=s.hasClass("admin-bar")?a.top+i.outerHeight():i.outerHeight();t.css("top",o)}else t.css("top","")}},{key:"sticky",value:function(){var e=this,t=e.element,s=e.body,n=e.desktop,i=c(".jupiterx-header"),a=i.data("jupiterx-settings").offset,o=e.window.scrollTop();if(e.window.width()<n)t.removeClass("sticked"),t.css("top","");else if(!t.hasClass("sticked")&&a<o&&s.hasClass("jupiterx-header-sticked")){var l=s.offset(),r=s.hasClass("admin-bar")?l.top+i.outerHeight():i.outerHeight();t.addClass("sticked"),t.css("top",r)}else t.hasClass("sticked")&&o<=a&&(t.removeClass("sticked"),t.css("top",""))}},{key:"getFilters",value:function(){var n={};return this.filters.each(function(e,t){var s=(t=c(t)).val();s&&(n[t.attr("name")]=s)}),n}},{key:"update",value:function(){this.updateResults(this.getFilters())}},{key:"clearFilters",value:function(){this.filters.filter(":not([name=product_id]):not([name=posts_per_page]):not([name=s])").each(function(e,t){(t=c(t)).val()&&t.val("").trigger("change",{clearFilters:!0})})}}]),n}(),i=function(){function s(e){_classCallCheck(this,s),this.element=c(e),this.window=c(window),this.checkboxes=this.element.find("input[type=checkbox]"),this.menu=this.element.find(".dropdown-menu"),this.values=this.element.find(".selected-values"),this.labels=this.element.find(".selected-labels"),this.clear=this.element.find(".clear-selected"),this.options={},this.desktop=768;var t=this.values.val();this.selected=t?t.split(","):[],this.init()}return _createClass(s,[{key:"init",value:function(){var s=this,t=s.element,n=s.window,e=s.checkboxes,i=s.clear,a=s.values,o=t.find(".dropdown-toggle");e.each(function(e,t){t=c(t),s.options[t.val()]=t.data("label")}),e.on("change",function(){var e=c(this);s.update(e.val(),e.is(":checked"))}),i.on("click",function(e){e.preventDefault(),e.stopPropagation(),s.clearSelected()}),a.on("change",function(e,t){t&&t.clearFilters&&s.clearSelected()}),o.on("click",function(e){e.preventDefault(),s.expand()}),c(document).on("click",function(e){n.width()>=s.desktop&&(t.is(e.target)||0!==t.has(e.target).length||s.collapse())}),t.on("click",".dropdown-menu",function(e){e.stopPropagation()})}},{key:"update",value:function(e,t){var s=this;t?this.selected.push(e):this.selected.splice(this.selected.indexOf(e),1),this.values.val(this.selected).trigger("change");var n=this.selected.map(function(e){return s.options[e]});n=n.length?n.join(", "):artbeesTemplates.i18n.all,this.labels.text(n),this.selected.length?this.clear.addClass("show"):this.clear.removeClass("show")}},{key:"clearSelected",value:function(){this.selected.length&&(this.selected=[],this.values.val(this.selected).trigger("change"),this.labels.text(artbeesTemplates.i18n.all),this.clear.removeClass("show"),this.checkboxes.each(function(e,t){c(t).attr("checked",!1)}))}},{key:"expand",value:function(){var e=this.element,t=this.window,s=this.menu,n=t.width()<=767?"show-mobile":"show",i=!(e.hasClass(n)||s.hasClass(n));e.toggleClass(n,i),s.toggleClass(n,i)}},{key:"collapse",value:function(){this.element.removeClass("show"),this.menu.removeClass("show")}}]),s}(),n=function(){function i(e){_classCallCheck(this,i);var t=e.node,s=e.getFilters,n=e.getPagination;this.element=c(t),this.window=c(window),this.document=c(document),this.getFilters=s,this.getPagination=n,this.jqxhr=null,this.page=1,this.ready=!0,this.maxed=!1,this.cache={},this.events()}return _createClass(i,[{key:"events",value:function(){switch(this.getPagination()){case"load_more":this.document.on("click",".ats-loadmore button",this.more.bind(this));break;default:this.window.on("scroll",_.throttle(this.scroll.bind(this),50))}}},{key:"scroll",value:function(){this.ready&&this.check()&&this.load(!1)}},{key:"more",value:function(){this.ready&&this.load(!1)}},{key:"reload",value:function(e){this.load(!0,e)}},{key:"load",value:function(t,s){var n=this;if(t||!n.maxed){var i=n.getFilters();n.ready=!1,n.element.children(".ats-placeholder, .ats-loader, .ats-empty, .ats-loadmore").remove(),t?(n.element.children(".ats-template").remove(),n.page=1,n.maxed=!1,n.placeholder(i)):n.element.append(c(n.loader())),i.page=n.page,Object.keys(i).forEach(function(e){i[e]||delete i[e]}),n.jqxhr&&n.jqxhr.abort&&n.jqxhr.abort(),n.jqxhr=c.ajax({method:"GET",url:"".concat(artbeesTemplates.api,"/list"),data:i}),n.jqxhr.done(function(e){n.element.children(".ats-placeholder, .ats-loader").remove(),e.posts&&e.posts.length?(e.posts.length<i.posts_per_page&&(n.maxed=!0),e.posts.forEach(function(e){n.element.append(c(n.card(e,i)))})):(n.maxed=!0,t&&n.element.append(c(n.empty()))),n.done(e,i),n.page++,n.ready=!0,"function"==typeof s&&s(e)})}}},{key:"done",value:function(e,t){this.maxed||"load_more"!==this.getPagination()||this.element.append(c(this.loadmore()))}},{key:"check",value:function(){var e=this.element.offset();if("object"!==_typeof(e))return!1;var t=this.window.scrollTop()+this.window.height();return this.element.outerHeight(!1)+e.top-1.3*this.window.height()<t}},{key:"empty",value:function(){return'\n      <div class="ats-empty">\n        <svg class="sad-tear" aria-hidden="true" focusable="false" width="50" height="50" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512">\n          <path fill="currentColor" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm8-152c-13.2 0-24 10.8-24 24s10.8 24 24 24c23.8 0 46.3 10.5 61.6 28.8 8.1 9.8 23.2 11.9 33.8 3.1 10.2-8.5 11.6-23.6 3.1-33.8C330 320.8 294.1 304 256 304zm-88-64c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160-64c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32zm-165.6 98.8C151 290.1 126 325.4 126 342.9c0 22.7 18.8 41.1 42 41.1s42-18.4 42-41.1c0-17.5-25-52.8-36.4-68.1-2.8-3.7-8.4-3.7-11.2 0z"></path>\n        </svg>\n        <p class="empty-title">'.concat(artbeesTemplates.i18n.empty,'</p>\n        <p class="empty-info">').concat(artbeesTemplates.i18n.emptyInfo,"</p>\n      </div>\n      ")}},{key:"placeholder",value:function(e){for(var t=e.posts_per_page||12,s=0;s<t;s++)this.element.append(c('\n      <div class="ats-template ats-placeholder">\n        <div class="card">\n          <div class="card-img"></div>\n          <div class="card-body">\n            <h3 class="template-name"></h3>\n            <span class="template-category"></span>\n          </div>\n        </div>\n      </div>\n      '))}},{key:"loader",value:function(){return'\n      <div class="ats-loader">\n        <span class="loader-round"></span>\n      </div>\n      '}},{key:"loadmore",value:function(){return'\n      <div class="ats-loadmore">\n        <button class="button">'.concat(artbeesTemplates.i18n.loadMore,"</button>\n      </div>\n      ")}},{key:"card",value:function(e,t){var s=e.demo_url,n=e.featured_image,i=e.title,a=e.category;return i=i.replace(" Jupiterx",""),t.category&&(a=a.filter(function(e){return-1<t.category.indexOf(e.slug)})),a=a[0].name||"",'\n      <a class="ats-template" target="_blank" href="'.concat(s,'">\n        <div class="card">\n          <div class="card-img">\n            <img class="card-img-top" src="').concat(n,'" alt="').concat(i,'">\n          </div>\n          <div class="card-body">\n            <h3 class="template-name">').concat(i,'</h3>\n            <span class="template-category">').concat(a,"</span>\n          </div>\n        </div>\n      </a>\n      ")}}]),i}(),a=function(){function t(e){_classCallCheck(this,t),this.element=c(e),this.window=c(window),this.html=c("html"),this.body=c("body"),this.count=this.element.find(".ats-toggle-filters .filters-count"),this.foundPosts=this.element.find(".ats-toggle-filters .found-posts"),this.pagination=this.element.data("pagination"),this.filters={},this.components={},this.init(),this.events()}return _createClass(t,[{key:"init",value:function(){var e=this.element,t=this.components;t.filters=new s({element:e.find(".ats-filters"),updateResults:this.updateResults.bind(this)}),t.results=new n({node:e.find(".ats-results"),getFilters:this.getFilters.bind(this),getPagination:this.getPagination.bind(this)}),this.updateResults(t.filters.getFilters())}},{key:"events",value:function(){var t=this,e=t.element,o=t.components,s=e.find(".ats-toggle-filters .ats-search-field"),n=this.element.find(".ats-toggle-filters .toggle-button"),i=this.element.find(".ats-header .close-button"),a=this.element.find(".ats-header .clear-filters");s.each(function(e,t){function s(){var e=o.filters.contentFilter;e.val(i.val()),e.trigger("keyup")}var n=c(t),i=n.find("input"),a=n.find(".clear-button");i.on("keyup",function(e){i.val()?a.show():a.hide(),13===e.keyCode&&(e.preventDefault(),s())}),n.on("click",".search-button",function(){s()}),a.on("click",function(){a.hide(),i.val(""),s()})}),n.on("click",function(e){e.preventDefault(),t.showHide(!0)}),i.on("click",function(e){e.preventDefault(),t.showHide(!1)}),a.on("click",function(){o.filters.clearFilters()})}},{key:"updateResults",value:function(e){var t=this,s=t.element,n=t.foundPosts,i=t.count,a=t.components;t.filters=_objectSpread({},e);var o=["s","posts_per_page","product_id"];for(var l in e)0<=o.indexOf(l)&&delete e[l];s.addClass("is-loading"),i.text(Object.keys(e).length||0),t.scroll(),a.results.reload(function(e){s.removeClass("is-loading"),n.text(e.found_posts||0)})}},{key:"getFilters",value:function(){return _objectSpread({},this.filters)}},{key:"scroll",value:function(){var e=this.element,t=this.window,s=this.html,n=this.body,i=e.offset().top;if(n.hasClass("admin-bar")){var a=s.css("margin-top");i-=parseFloat(a)}t.scrollTop()>i&&t.scrollTop(i)}},{key:"showHide",value:function(e){var t=this.components,s=this.body;t.filters.element.toggleClass("show",e),s.toggleClass("ats-block-scroll",e)}},{key:"getPagination",value:function(){return this.pagination}}]),t}();c(".artbees-templates-search").each(function(e,t){new a(t)})}(jQuery);